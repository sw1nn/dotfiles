#!/bin/bash

if [ "$(hostname)" != "alison" ]; then
  ssh -t alison.isismanor.com irc
  exit 0
fi

if [ "$TERM" = "dumb" ]; then
    exec st -t Irc -e irc
fi

T3=$(pidof irssi)

irssi_nickpane() {
    tmux setw main-pane-width $(( $(tput cols) - 21));
    tmux splitw -v "cat ~/.irssi/nicklistfifo";
    tmux selectl main-vertical;
    tmux selectw -t irssi;
    tmux selectp -t 0;
}

irssi_repair() {
    tmux selectw -t irssi
    (( $(tmux lsp | wc -l) > 1 )) && tmux killp -a -t 0
    irssi_nickpane
}

if [ -z "$T3" ]; then
    tmux new-session -d -s IRC;
    tmux new-window -t IRC -n irssi irssi;
    irssi_nickpane ;
fi

tmux attach-session -d -t IRC;
irssi_repair ;

exit 0
